define(['jquery','mage/translate','underscore','mage/template','mage/mage','Magento_Catalog/js/catalog-add-to-cart','domReady!'],function($,$t,_,mageTemplate){'use strict';$.widget('diptyque.catalogAddToCart',$.mage.catalogAddToCart,{options:{processStart:null,processStop:null,bindSubmit:true,minicartSelector:'[data-block="minicart"]',messagesSelector:'[data-placeholder="messages"]',productStatusSelector:'.stock.available',addToCartButtonSelector:'.action.tocart',addToCartButtonDisabledClass:'disabled',addToCartButtonTextWhileAdding:'',addToCartButtonTextAdded:'',addToCartButtonTextDefault:'',modal:{div:'#tocart-modal',type:'popup',responsive:true,innerScroll:true,buttons:[{text:'',class:'action continue',click:function(){this.closeModal();}},{text:$.mage.__('Checkout'),class:'action primary',click:function(){this.closeModal();}}],modalClass:'catalog-add-to-cart'}},title:$.mage.__('Added to cart'),button2Text:$.mage.__('View shopping bag'),cartButtonText:$.mage.__('Continue Shopping'),ajaxSubmit:function(form){var self=this;var bodyNode=$('body');let productDataItem=form.closest('.product-item');$(self.options.minicartSelector).trigger('contentLoading');self.disableAddToCartButton(form);$(".ui-dialog.ui-widget.ui-widget-content.ui-corner-all.ui-front.mage-dropdown-dialog").show();$(".minicart-wrapper").addClass('active');$(".action.showcart").addClass('active');bodyNode.css('overflow','hidden');$('div.header-right-links').prepend('<div class="minicart-sidebar-background"></div>');$('.sticky-search-toogle').css('z-index',100);$('header.page-header').css('z-index',105);let couponCodeField=$('#coupon_minicart_code');if(couponCodeField.val()){couponCodeField.css('pointer-events','none');}
$.ajax({url:form.attr('action'),data:form.serialize(),type:'post',dataType:'json',beforeSend:function(){bodyNode.trigger('processStart');bodyNode.css('pointer-events','none');$(".minicart-content-wrapper").addClass("act");$(".loading-mask").addClass("run");},success:function(res){var eventData,parameters;if(self.isLoaderEnabled()){$('body').trigger(self.options.processStop);}
if(typeof dataLayer!=='undefined'&&(productDataItem.length||form.closest('.product-info-main').length)){let productQuantity=1;if(typeof res.item!=='undefined'){productQuantity=res.item.qty;}
let addingProduct={};if(typeof window.productData!=='undefined'){addingProduct=window.productData;}else if(productDataItem&&typeof productDataItem.attr('data-layer-collected')!=='undefined'){addingProduct=JSON.parse(productDataItem.attr('data-layer-collected'));}
addingProduct['quantity']=parseInt(productQuantity);if(!$.isEmptyObject(addingProduct)){let productLists=JSON.parse(localStorage.getItem("productLists")),indexToChange=0,isProductInObject,listToAdd={"list":addingProduct.item_list_name,"productId":addingProduct.item_id,"productName":addingProduct.item_name,"productPrice":addingProduct.price,"itemCategory1":addingProduct.item_category,"itemCategory2":addingProduct.item_category2,"itemCategory3":addingProduct.item_category3,"itemVariant":addingProduct.item_variant};if(productDataItem.length){if(!productLists){localStorage.setItem("productLists","["+JSON.stringify(listToAdd)+"]");}else{productLists.find((o,i)=>{if(o.productId===addingProduct.item_id){isProductInObject=true;indexToChange=i;return true;}});if(!isProductInObject){productLists[productLists.length]=listToAdd;}else{productLists[indexToChange]={"list":addingProduct.item_list_name,"productId":addingProduct.item_id,"productName":addingProduct.item_name};}
localStorage.setItem("productLists",JSON.stringify(productLists));}}else{let recentListName='';if(!productLists){localStorage.setItem("productLists","["+JSON.stringify(listToAdd)+"]");}else{productLists.find((o)=>{if(o.productId===addingProduct.item_id){isProductInObject=true;recentListName=o.list;return true;}});}
if(isProductInObject){addingProduct.item_list_name=recentListName}}
dataLayer.push({event:"add_to_cart",ecommerce:{items:[addingProduct]}});}}
if(res.backUrl){eventData={'form':form,'redirectParameters':[]};bodyNode.trigger('catalogCategoryAddToCartRedirect',eventData);if(eventData.redirectParameters.length>0){parameters=res.backUrl.split('#');parameters.push(eventData.redirectParameters.join('&'));res.backUrl=parameters.join('#');}
window.location=res.backUrl;return;}
if(res.messages){$(self.options.messagesSelector).html(res.messages);}
if(res.minicart){$(self.options.minicartSelector).replaceWith(res.minicart);$(self.options.minicartSelector).trigger('contentUpdated');}
if(res.product&&res.product.statusText){$(self.options.productStatusSelector).removeClass('available').addClass('unavailable').find('span').html(res.product.statusText);}
self.enableAddToCartButton(form);if(!$('[data-role=product-item]').length){setTimeout(()=>{$(self.options.minicartSelector).find('.showcart').trigger('click');},2500);}else{$(self.options.minicartSelector).find('.showcart').trigger('click');}
setTimeout(()=>{bodyNode.trigger('processStop');bodyNode.css('pointer-events','auto');$(".minicart-content-wrapper").removeClass("act");$(".loading-mask").removeClass("run");},2500);}});}});return $.diptyque.catalogAddToCart;});