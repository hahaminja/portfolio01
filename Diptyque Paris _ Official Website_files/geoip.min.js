define(["jquery",'Magento_Checkout/js/model/error-processor',"mage/cookies"],function($,errorProcessor){"use strict";$.widget('vaimo.geoip',{options:{ajaxCheckUrl:'',ajaxRedirectRequiredUrl:'',pathInfo:''},redirectRequired:0,_create:function(){let loaderBlock=$(this.element),geoIpCookie=$.mage.cookies.get('geoip_store_code'),isSocialMedia=this.isSocialMediaReferer();if(isSocialMedia){this.isRedirectRequired(loaderBlock);}
if(!isSocialMedia&&typeof geoIpCookie!=='string'){this.isRedirectRequired(loaderBlock);}},isSocialMediaReferer:function(){let query=window.location.search.substring(1),queryParams=query.split('&'),queryParamsMap=new Map(),keyValue;for(let i=0;i<queryParams.length;i++){keyValue=queryParams[i].split('=');queryParamsMap.set(keyValue[0],keyValue[1]);}
return queryParamsMap.has('utm_medium');},isRedirectRequired:function(loaderBlock){let self=this;$.ajax({url:this.options.ajaxRedirectRequiredUrl,type:"POST",data:'',}).done(function(response){if(response.isRedirectRequired===1){self.toggleLoader(loaderBlock);self.checkRedirectUrl(loaderBlock);}}).fail(function(response){errorProcessor.process(response);});},checkRedirectUrl:function(loaderBlock){let self=this;$.ajax({url:this.options.ajaxCheckUrl,type:"POST",data:{pathInfo:this.options.pathInfo},}).done(function(response){if(response.redirectUrl){window.location.replace(response.redirectUrl);}}).fail(function(response){errorProcessor.process(response);}).always(function(){setTimeout(function(){self.toggleLoader(loaderBlock);},1500);});},toggleLoader:function(loaderBlock){loaderBlock.toggle();}});return $.vaimo.geoip;});