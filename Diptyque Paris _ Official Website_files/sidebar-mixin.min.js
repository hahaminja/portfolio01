define(['jquery','Magento_Customer/js/model/authentication-popup','Magento_Customer/js/customer-data'],function($,authenticationPopup,customerData){'use strict';return function(widget){$.widget('diptyque.sidebar',widget,{_initContent:function(){var self=this,events={};this.element.decorate('list',this.options.isRecursive);events['click '+this.options.button.close]=function(event){event.stopPropagation();$(self.options.targetElement).dropdownDialog('close');};events['click '+this.options.button.checkout]=$.proxy(function(){var cart=customerData.get('cart'),customer=customerData.get('customer'),element=$(this.options.button.checkout);if(!customer().firstname&&cart().isGuestCheckoutAllowed===false){$.cookie('login_redirect',this.options.url.checkout);if(this.options.url.isRedirectRequired){element.prop('disabled',true);location.href=this.options.url.loginUrl;}else{authenticationPopup.showModal();}
return false;}
element.prop('disabled',true);location.href=this.options.url.checkout;},this);events['click '+this.options.button.remove]=function(event){event.stopPropagation();self._removeItem($(event.currentTarget));};events['click .update-cart-item']=function(event){event.stopPropagation();self._updateItemQty($(event.currentTarget));};events['change '+this.options.item.qty]=function(event){self._updateItemQtyChange($(event.currentTarget));};this._on(this.element,events);this._isOverflowed();},_updateItemQty:function(elem){var itemId=elem.data('cart-item');let dataQtyElement=$('#cart-item-'+itemId+'-qty');let dataQty=dataQtyElement.val();if(elem.data('role')==='minus'){if(dataQty>1){dataQty--;}}else{dataQty++;}
dataQtyElement.val(dataQty);this._ajax(this.options.url.update,{'item_id':itemId,'item_qty':dataQty},elem,this._updateItemQtyAfter);},_updateItemQtyChange:function(elem){var itemId=elem.data('cart-item');this._ajax(this.options.url.update,{'item_id':itemId,'item_qty':elem.val()},elem,this._updateItemQtyAfter);},update:function(){$(this.options.targetElement).trigger('contentUpdated');this._isOverflowed();},});return $.diptyque.sidebar;};});